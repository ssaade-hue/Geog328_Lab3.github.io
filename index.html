<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<title>Japan's Tallest Peaks</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
	<style>
		body { margin: 0; padding: 0; }
		#container {
			display: flex;
			height: 100vh;
			flex-direction: row;
			align-items: stretch;
		}
		#side-panel {
			flex-basis: 400px;
			overflow-y: auto;
			background: #222;
			color: #f5f5f5;
			box-shadow: -2px 0 8px rgba(0,0,0,0.12);
			z-index: 2;
		}
		#map { flex-grow: 1; }
		button { margin-bottom: 10px; }
		table {
			border-collapse: collapse;
			width: 100%;
			background-color: #222;
			color: #f5f5f5;
			border: 1px solid #444;
			font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
			font-size: 15px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.15);
		}
		th {
			background-color: #333;
			color: #fff;
			font-weight: 600;
			text-align: left;
			padding: 14px 16px;
			border-bottom: 2px solid #444;
		}
		td {
			text-align: left;
			padding: 12px 16px;
			border-bottom: 1px solid #444;
		}
		tr { transition: background 0.2s; }
		tr:nth-child(even) { background-color: #262626; }
		tr:hover { background-color: #2a2a2a; }
		@media (max-width: 1024px) {
			#side-panel { display: none; }
		}
	</style>
</head>

<body>
	<main id="container">
		<div id="side-panel">
			<h2>Japan's Tallest Peaks</h2>
			<button>Sort by Distance from Tokyo Tower</button>
			<table>
				<tr>
					<th>Name</th>
					<th>Height (m)</th>
					<th>Location</th>
					<th>Distance (km)</th>
				</tr>
			</table>
		</div>
		<div id="map"></div>
	</main>
	<script>
		mapboxgl.accessToken = 'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNqaW85NzNrdDA3OXczcHQ5aTZvYmtjc2gifQ.ummEQxsRIweCIdv9CRRzOw';
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11',
			zoom: 5.5,
			center: [138, 38]
		});

		async function geojsonFetch() {
			let response, peaks, table;
			response = await fetch('assets/tallest_peaks.geojson');
			peaks = await response.json();

			// Tokyo Tower coordinates
			const tokyoTower = [139.7454, 35.6586];

			// Calculate distance (Haversine formula)
			function getDistance(coord1, coord2) {
				const toRad = x => x * Math.PI / 180;
				const R = 6371; // km
				const dLat = toRad(coord2[1] - coord1[1]);
				const dLon = toRad(coord2[0] - coord1[0]);
				const lat1 = toRad(coord1[1]);
				const lat2 = toRad(coord2[1]);
				const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
						  Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2);
				const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
				return R * c;
			}

			// Add distance property to each peak
			peaks.features.forEach(f => {
				f.properties.distance = getDistance(tokyoTower, f.geometry.coordinates);
			});

			// Sort by distance
			peaks.features.sort((a, b) => a.properties.distance - b.properties.distance);

			table = document.getElementsByTagName("table")[0];
			let row, cell1, cell2, cell3, cell4;
			for (let i = 0; i < peaks.features.length; i++) {
				row = table.insertRow(-1);
				cell1 = row.insertCell(0);
				cell2 = row.insertCell(1);
				cell3 = row.insertCell(2);
				cell4 = row.insertCell(3);
				cell1.innerHTML = peaks.features[i].properties.name;
				cell2.innerHTML = peaks.features[i].properties.height;
				cell3.innerHTML = peaks.features[i].properties.location;
				cell4.innerHTML = peaks.features[i].properties.distance.toFixed(2);
			}

			map.on('load', function() {
				map.addSource('tallest-peaks', { type: 'geojson', data: peaks });
				map.addLayer({
					'id': 'tallest-peaks-layer',
					'type': 'circle',
					'source': 'tallest-peaks',
					'paint': {
						'circle-radius': 8,
						'circle-stroke-width': 2,
						'circle-color': '#ff6600',
						'circle-stroke-color': 'white'
					}
				});
			});
		}
		geojsonFetch();
		let btn = document.getElementsByTagName("button")[0];
		btn.addEventListener('click', sortTable);
		// Sort table by distance (km)
		function sortTable(e) {
			let table, rows, switching, i, x, y, shouldSwitch;
			table = document.getElementsByTagName("table")[0];
			switching = true;
			while (switching) {
				switching = false;
				rows = table.rows;
				for (i = 1; i < (rows.length - 1); i++) {
					shouldSwitch = false;
					x = parseFloat(rows[i].getElementsByTagName("td")[3].innerHTML);
					y = parseFloat(rows[i + 1].getElementsByTagName("td")[3].innerHTML);
					if (x > y) {
						shouldSwitch = true;
						break;
					}
				}
				if (shouldSwitch) {
					rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
					switching = true;
				}
			}
		}
	</script>
</body>
</html>
